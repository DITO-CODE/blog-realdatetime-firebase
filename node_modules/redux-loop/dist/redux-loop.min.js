!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.ReduxLoop={})}(this,function(t){"use strict";function e(){var t=arguments[1],e=arguments[2];return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(function(n){return n===A?t:n===C?e:n})}function n(t,n,r){var o=t.successActionCreator||function(){},i=t.failActionCreator||function(){};try{var u=t.func.apply(t,v(e(t.args,n,r)));if(g(u)&&!t.forceSync)return u.then(o,i).then(function(t){return t?[t]:[]});var c=o(u);return c?Promise.resolve([c]):null}catch(e){if(!t.failActionCreator)throw console.error(e),e;var a=i(e);return a?Promise.resolve([a]):null}}function r(t,e,n){var r=t.batch,o=void 0!==r&&r,i=t.cmds.map(function(t){var r=x(t,e,n);return!r||o?r:r.then(function(t){return Promise.all(t.map(function(t){return e(t)}))})}).filter(function(t){return t});return 0===i.length?null:Promise.all(i).then(b).then(function(t){return o?t:[]})}function o(t,e,n){var r=t.cmds,o=t.batch,i=void 0!==o&&o,u=r.length?r[0]:null;if(!u)return null;var c=new Promise(function(t){var o=x(u,e,n);(o=o||Promise.resolve([])).then(function(o){(i?Promise.resolve():Promise.all(o.map(function(t){return e(t)}))).then(function(){var u=O(r.slice(1),{batch:i,sequence:!0}),c=x(u,e,n);c?c.then(function(e){t(o.concat(e))}):t(o)})})}).then(b);return i?c:c.then(function(){return[]})}function i(t){var e=t.result,n=t.success;return n&&this.successActionCreator?this.successActionCreator(e):!n&&this.failActionCreator?this.failActionCreator(e):null}function u(){return this.actionToDispatch}function c(t){return b(this.cmds.map(function(e,n){return e.simulate(t[n])}).filter(function(t){return t}))}function a(t){var e=this,n=this.nestedCmd.simulate(t);return Array.isArray(n)?n.map(function(t){return e.tagger.apply(e,v(e.args).concat([t]))}):n?this.tagger.apply(this,v(this.args).concat([n])):null}function s(t){switch(t.length){case 0:return j.none;case 1:return t[0];default:return j.list(t)}}var l,f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d=(function(){function t(t){this.value=t}function e(e){function n(o,i){try{var u=e[o](i),c=u.value;c instanceof t?Promise.resolve(c.value).then(function(t){n("next",t)},function(t){n("throw",t)}):r(u.done?"return":"normal",u.value)}catch(t){r("throw",t)}}function r(t,e){switch(t){case"return":o.resolve({value:e,done:!0});break;case"throw":o.reject(e);break;default:o.resolve({value:e,done:!1})}(o=o.next)?n(o.key,o.arg):i=null}var o,i;this._invoke=function(t,e){return new Promise(function(r,u){var c={key:t,arg:e,resolve:r,reject:u,next:null};i?i=i.next=c:(o=i=c,n(t,e))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)}}(),function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}),p=Object.assign||function(t){for(var e=1;arguments.length>e;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},h=function(t,e){var n={};for(var r in t)0>e.indexOf(r)&&Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n},m=function(){function t(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var u,c=t[Symbol.iterator]();!(r=(u=c.next()).done)&&(n.push(u.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&c.return&&c.return()}finally{if(o)throw i}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),v=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);t.length>e;e++)n[e]=t[e];return n}return Array.from(t)},y=Array.prototype.concat,b=function(t){return y.apply([],t)},g=function(t){return"object"===(void 0===t?"undefined":f(t))&&"function"==typeof t.then},w=Symbol("isCmd"),A=Symbol("dispatch"),C=Symbol("getState"),P=function(t){return!!t&&!!t[w]},x=function t(e,i,u){switch(e.type){case"RUN":return n(e,i,u);case"ACTION":return Promise.resolve([e.actionToDispatch]);case"LIST":return e.sequence?o(e,i,u):r(e,i,u);case"MAP":var c=t(e.nestedCmd,i,u);return c?c.then(function(t){return t.map(function(t){return e.tagger.apply(e,v(e.args).concat([t]))})}):null;case"NONE":return null;default:throw Error("Invalid Cmd type "+e.type)}},O=function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(n.testInvariants)throw Error("Redux Loop: Detected usage of Cmd.list's testInvariants option in production code. This should only be used in tests.");var r=h(n,["testInvariants"]);return Object.freeze(p((e={},d(e,w,!0),d(e,"type","LIST"),d(e,"cmds",t),d(e,"simulate",c),e),r))},S=Object.freeze((l={},d(l,w,!0),d(l,"type","NONE"),d(l,"simulate",function(){return null}),l)),j={run:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(n.testInvariants)throw Error("Redux Loop: Detected usage of Cmd.run's testInvariants option in production code. This should only be used in tests.");var r=h(n,["testInvariants"]);return Object.freeze(p((e={},d(e,w,!0),d(e,"type","RUN"),d(e,"func",t),d(e,"simulate",i),e),r))},action:function(t){var e;return Object.freeze((e={},d(e,w,!0),d(e,"type","ACTION"),d(e,"actionToDispatch",t),d(e,"simulate",u),e))},list:O,batch:function(t){return console.warn("Cmd.batch is deprecated and will be removed in version 5. Please use Cmd.list (https://github.com/redux-loop/redux-loop/blob/master/docs/ApiDocs.md#cmdlistcmds-options)"),O(t,{batch:!0,sequence:!1})},sequence:function(t){return console.warn("Cmd.sequence is deprecated and will be removed in version 5. Please use Cmd.list (https://github.com/redux-loop/redux-loop/blob/master/docs/ApiDocs.md#cmdlistcmds-options)"),O(t,{batch:!0,sequence:!0})},map:function(t,e){for(var n=arguments.length,r=Array(n>2?n-2:0),o=2;n>o;o++)r[o-2]=arguments[o];var i;return Object.freeze((i={},d(i,w,!0),d(i,"type","MAP"),d(i,"tagger",e),d(i,"nestedCmd",t),d(i,"args",r),d(i,"simulate",a),i))},none:S,dispatch:A,getState:C},I=function(t){return Array.isArray(t)&&2===t.length&&P(t[1])&&!P(t[0])},T=function(t){return I(t)?t[1]:null},k=function(t){return I(t)?t[0]:t},R=function(t,e){return[t,e]},N=function(t){return I(t)?t:R(t,j.none)},D=function(t,e){return"\nException thrown when running Cmds from action: "+t+".\n\nThrown exception: \n"+e+"\n"},E=function(t,e){return t[e]},L=function(t,e,n){return p({},t,d({},e,n))};t.combineReducers=function(t,e,n,r){return(n||r||e)&&console.warn("Passing customization parameters to combineReducers is deprecated. They will be removed in 5.0. \n      Integrations with popular libraries are being broken out into separate libraries. \n      Please see https://github.com/redux-loop/redux-loop/releases/tag/v4.2.0 for more details."),e=e||{},n=n||E,r=r||L,function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e,i=arguments[1],u=!1,c=[],a=Object.keys(t).reduce(function(e,a){var s=t[a],l=n(o,a),f=s(l,i);return I(f)&&(c.push(T(f)),f=k(f)),u=u||f!==l,r(e,a,f)},e);return R(u?a:o,j.list(c,{batch:!0}))}},t.mergeChildReducers=function(t,e,n){var r=t,o=void 0;I(r)&&(o=T(r),r=k(r));var i=o?[o]:[],u=!1,c=Object.keys(n).reduce(function(t,r){var o=n[r];if(!o)return u||(t=p({},t),u=!0),delete t[r],t;var c=o(t[r],e);return I(c)&&(i.push(T(c)),c=k(c)),t[r]!==c&&u?t[r]=c:t[r]!==c&&(t=p({},t,d({},r,c)),u=!0),t},r);return R(c,s(i))},t.Cmd=j,t.install=function(){return function(t){return function(e,n,r){var o=N(n),i=m(o,2),u=i[0],c=i[1],a=[],s=function(t){return function(e,n){var r=t(e,n),o=N(r),i=m(o,2),u=i[0];return a.push({originalAction:n,cmd:i[1]}),u}},l=t(s(e),u,r),f=function(t){var e=t.map(d).filter(function(t){return t});return 0===e.length?Promise.resolve():1===e.length?e[0]:Promise.all(e).then(function(){})},d=function(t){var e=t.originalAction,n=x(t.cmd,h,l.getState);return n?n.then(function(t){if(t.length)return Promise.all(t.map(h))}).catch(function(t){throw console.error(D(e.type,t)),t}):null},h=function(t){l.dispatch(t);var e=a;return a=[],f(e)};return d({originalAction:{type:"@@ReduxLoop/INIT"},cmd:c}),p({},l,{dispatch:h,replaceReducer:function(t){return l.replaceReducer(s(t))}})}}},t.loop=R,t.liftState=N,t.getModel=k,t.getCmd=T,t.isLoop=I,Object.defineProperty(t,"__esModule",{value:!0})});
